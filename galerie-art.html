<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Photographe et videaste professionnel. Portrait, mariage, evenementiel et creation de contenus video.">
  <title>E BERREL| Photographe & Videaste</title>

  <link rel="icon" href="images/favicon_dark.ico" media="(prefers-color-scheme: dark)">
  <link rel="icon" href="images/favicon_light.ico" media="(prefers-color-scheme: light)">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="bg-canvas" aria-hidden="true">
    <span class="bg-bird bird-1" data-sx="-0.06" data-sy="0.22"></span>
    <span class="bg-bird bird-2" data-sx="0.08" data-sy="0.18"></span>
    <span class="bg-bird bird-3" data-sx="0.04" data-sy="-0.12"></span>
    <span class="bg-bird bird-4" data-sx="-0.1" data-sy="0.15"></span>
    <span class="bg-bird bird-5" data-sx="0.12" data-sy="0.1"></span>
    <span class="bg-bird bird-6" data-sx="-0.05" data-sy="-0.16"></span>
  </div>

  <header class="site-header" id="top">
    <a class="brand" href="index.html" aria-label="Retour en haut">
      <img src="images/logo_light.png" alt="Logo Studio Visuel" class="brand-logo light-logo">
      <img src="images/logo_dark.png" alt="Logo Studio Visuel" class="brand-logo dark-logo">
      <span class="brand-name">BERREL</span>
    </a>

    <button class="menu-toggle" aria-expanded="false" aria-controls="main-nav" aria-label="Ouvrir le menu">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav id="main-nav" class="main-nav" aria-label="Navigation principale">
      <a href="index.html#galerie" data-tab-target="galerie">Galerie</a>
      <a href="index.html#boutique" data-tab-target="boutique">Boutique</a>
      <a href="index.html#contact" data-tab-target="contact" class="cta-nav">Contact</a>
    </nav>
  </header>

  <main>
    <section class="section art-gallery-section">
      <div class="section-heading">
        <p class="eyebrow">Galerie Artistique</p>
        <h1>Toutes les photos</h1>
      </div>

      <div id="art-gallery-grid" class="art-gallery-grid" aria-live="polite"></div>

      <div class="art-gallery-actions">
        <button id="load-more-art" class="btn btn-primary" type="button">Charger plus</button>
      </div>
    </section>
    
    <section class="section about" id="about">
      <div class="section-heading">
        <p class="eyebrow">A propos</p>
        <h2>Un regard sensible et exigeant</h2>
      </div>
      <p>
        Base en France, j'accompagne particuliers, entreprises et artistes dans la creation de visuels impactants.
        Mon objectif: produire des images esthetiques, authentiques et utiles pour vos souvenirs comme pour votre communication.
      </p>
    </section>
  </main>




<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>


  <footer class="site-footer">
    <p>&copy; <span id="year"></span> Studio Visuel. Tous droits reserves.</p>
  </footer>

  <nav class="bottom-tabs" role="tablist" aria-label="Navigation onglets">
    <button class="tab-btn is-active" role="tab" aria-selected="true" aria-controls="panel-galerie" id="tab-galerie" data-tab-target="galerie">
      <span class="tab-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <rect x="3.5" y="5.5" width="17" height="13" rx="2"></rect>
          <circle cx="9" cy="10" r="1.8"></circle>
          <path d="M20.5 15l-4.6-4.6-5.2 5.2"></path>
        </svg>
      </span>
      <span>Galerie</span>
    </button>
    <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-boutique" id="tab-boutique" data-tab-target="boutique">
      <span class="tab-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M5 7h14l-1.2 10.5a2 2 0 0 1-2 1.8H8.2a2 2 0 0 1-2-1.8L5 7z"></path>
          <path d="M9 7a3 3 0 1 1 6 0"></path>
        </svg>
      </span>
      <span>Boutique</span>
    </button>
    <button class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-contact" id="tab-contact" data-tab-target="contact">
      <span class="tab-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24">
          <path d="M4 6.5h16v11H4z"></path>
          <path d="M4.5 7l7.5 6 7.5-6"></path>
        </svg>
      </span>
      <span>Contact</span>
    </button>
  </nav>

  <script>
    (function () {
      const photoFiles = [
        'hero.jpg',
        'art1.jpg',
        'art2.jpg',
        'art3.jpg',
        'art4.jpg',
        'art5.jpg',
        'art6.jpg',
        'art7.jpg',
        'art8.jpg',
        'art9.jpg',
        'art10.jpg',
        'art11.jpg',
        'art12.jpg',
        'art13.jpg',
        'art14.jpg',
        'art15.jpg',
        'art16.jpg',
        'art17.jpg',
        'art18.jpg',
        'art19.jpg',
        'art20.jpg',
        'art21.jpg',
        'art22.jpg',
        'art23.jpg',
        'art24.jpg',
        'art25.jpg',
        'art26.jpg',
        'art27.jpg',
        'art28.jpg',
        'art29.jpg',
        'art30.jpg',
        'art31.jpg',
        'art32.jpg'
      ];

      const collator = new Intl.Collator('fr', { numeric: true, sensitivity: 'base' });
      const sortedFiles = [...photoFiles].sort((a, b) => {
        if (a.toLowerCase() === 'hero.jpg') return -1;
        if (b.toLowerCase() === 'hero.jpg') return 1;
        return collator.compare(a, b);
      });

      const grid = document.getElementById('art-gallery-grid');
      const loadMoreButton = document.getElementById('load-more-art');
      const batchSize = 12;
      const largeImageRoot = 'galerie/art/grand';
      let renderedCount = 0;
      const colorCache = new Map();
      let printOptionsModal = null;

      function clamp(value, min, max) {
        return Math.min(max, Math.max(min, value));
      }

      function rgbToHsl(r, g, b) {
        const rNorm = r / 255;
        const gNorm = g / 255;
        const bNorm = b / 255;
        const max = Math.max(rNorm, gNorm, bNorm);
        const min = Math.min(rNorm, gNorm, bNorm);
        const delta = max - min;
        let h = 0;
        let s = 0;
        const l = (max + min) / 2;

        if (delta !== 0) {
          s = delta / (1 - Math.abs(2 * l - 1));

          switch (max) {
            case rNorm:
              h = 60 * (((gNorm - bNorm) / delta) % 6);
              break;
            case gNorm:
              h = 60 * ((bNorm - rNorm) / delta + 2);
              break;
            default:
              h = 60 * ((rNorm - gNorm) / delta + 4);
              break;
          }
        }

        return {
          h: Math.round((h + 360) % 360),
          s: Math.round(s * 100),
          l: Math.round(l * 100)
        };
      }

      function getDominantColorFromImage(image) {
        return new Promise((resolve, reject) => {
          if (!image.complete || image.naturalWidth === 0) {
            reject(new Error('Image not ready'));
            return;
          }

          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d', { willReadFrequently: true });

          if (!context) {
            reject(new Error('Canvas unavailable'));
            return;
          }

          const sampleSize = 40;
          canvas.width = sampleSize;
          canvas.height = sampleSize;
          context.drawImage(image, 0, 0, sampleSize, sampleSize);

          const { data } = context.getImageData(0, 0, sampleSize, sampleSize);
          let redWeighted = 0;
          let greenWeighted = 0;
          let blueWeighted = 0;
          let weightSum = 0;

          for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];
            const a = data[i + 3];

            if (a < 140) {
              continue;
            }

            const hsl = rgbToHsl(r, g, b);
            const saturationWeight = Math.max(0.2, hsl.s / 100);
            const lightnessWeight = 1 - Math.abs(hsl.l - 52) / 52;
            const weight = saturationWeight * Math.max(0.15, lightnessWeight);

            redWeighted += r * weight;
            greenWeighted += g * weight;
            blueWeighted += b * weight;
            weightSum += weight;
          }

          if (weightSum === 0) {
            reject(new Error('No usable pixels'));
            return;
          }

          resolve({
            r: Math.round(redWeighted / weightSum),
            g: Math.round(greenWeighted / weightSum),
            b: Math.round(blueWeighted / weightSum)
          });
        });
      }

      function applyColorShadow(image, rgbColor) {
        const hsl = rgbToHsl(rgbColor.r, rgbColor.g, rgbColor.b);
        const shadowHue = hsl.h;
        const shadowSat = clamp(hsl.s + 12, 35, 90);
        const shadowLight = clamp(hsl.l - 4, 22, 62);
        image.style.boxShadow = `0 18px 38px hsl(${shadowHue} ${shadowSat}% ${shadowLight}% / 0.42)`;
      }

      async function syncCardShadow(image) {
        const cacheKey = image.currentSrc || image.src;

        if (colorCache.has(cacheKey)) {
          applyColorShadow(image, colorCache.get(cacheKey));
          return;
        }

        try {
          const rgbColor = await getDominantColorFromImage(image);
          colorCache.set(cacheKey, rgbColor);
          applyColorShadow(image, rgbColor);
        } catch (error) {
          // Keep CSS fallback shadow.
        }
      }

      function setLoadMoreVisible(isVisible) {
        loadMoreButton.style.visibility = isVisible ? 'visible' : 'hidden';
        loadMoreButton.disabled = !isVisible;
      }

      function syncImageBoxSize(image, imageBox) {
        imageBox.style.width = `${image.clientWidth}px`;
        imageBox.style.height = `${image.clientHeight}px`;
      }

      function createImageModal() {
        const overlay = document.createElement('div');
        overlay.className = 'image-lightbox';
        overlay.innerHTML = `
          <div class="image-lightbox__panel" role="dialog" aria-modal="true" aria-label="Photo en grand format">
            <button class="image-lightbox__close" type="button" aria-label="Fermer">&times;</button>
            <p class="image-lightbox__status">Chargement...</p>
            <img class="image-lightbox__image" alt="" hidden>
            <button class="btn image-lightbox__add" type="button" hidden>Ajouter au panier</button>
          </div>
        `;

        const panel = overlay.querySelector('.image-lightbox__panel');
        const closeButton = overlay.querySelector('.image-lightbox__close');
        const status = overlay.querySelector('.image-lightbox__status');
        const modalImage = overlay.querySelector('.image-lightbox__image');
        const addToCartButton = overlay.querySelector('.image-lightbox__add');

        let candidates = [];
        let candidateIndex = 0;

        function resetImage() {
          modalImage.hidden = true;
          modalImage.removeAttribute('src');
          addToCartButton.hidden = true;
        }

        function close() {
          overlay.classList.remove('is-open');
          document.body.classList.remove('lightbox-open');
          resetImage();
          status.hidden = false;
          status.textContent = 'Chargement...';
        }

        function tryNextSource() {
          if (candidateIndex >= candidates.length) {
            resetImage();
            status.hidden = false;
            status.textContent = 'Image indisponible.';
            return;
          }

          const nextSource = candidates[candidateIndex];
          candidateIndex += 1;
          modalImage.src = nextSource;
        }

        modalImage.addEventListener('load', () => {
          status.hidden = true;
          modalImage.hidden = false;
          addToCartButton.hidden = false;
        });

        modalImage.addEventListener('error', tryNextSource);

        addToCartButton.addEventListener('click', () => {
          if (printOptionsModal) {
            printOptionsModal.open();
          }
        });

        closeButton.addEventListener('click', close);
        overlay.addEventListener('click', (event) => {
          if (event.target === overlay) {
            close();
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && overlay.classList.contains('is-open')) {
            close();
          }
        });

        document.body.appendChild(overlay);

        return {
          open({ sources, alt }) {
            candidates = sources.filter(Boolean);
            candidateIndex = 0;
            modalImage.alt = alt || '';
            status.hidden = false;
            status.textContent = 'Chargement...';
            overlay.classList.add('is-open');
            document.body.classList.add('lightbox-open');
            tryNextSource();
            panel.focus?.();
          }
        };
      }

      function createPrintOptionsModal() {
        const overlay = document.createElement('div');
        overlay.className = 'print-modal';
        overlay.innerHTML = `
          <div class="print-modal__panel" role="dialog" aria-modal="true" aria-label="Choix d'impression">
            <button class="print-modal__close" type="button" aria-label="Fermer">&times;</button>
            <h2 class="print-modal__title">Choisir votre tirage</h2>
            <p class="print-modal__subtitle">Sélectionnez un format et un type d'impression.</p>

            <div class="print-modal__group">
              <span class="print-modal__label">Type de papier</span>
              <div class="print-modal__options" role="group" aria-label="Choix du type de papier">
                <button class="btn print-modal__option is-selected" type="button" aria-pressed="true">Papier brillant</button>
                <button class="btn print-modal__option" type="button" aria-pressed="false">Papier mat</button>
              </div>
            </div>

            <div class="print-modal__group">
              <span class="print-modal__label">Format d'impression</span>
              <div class="print-modal__options" role="group" aria-label="Choix du format d'impression">
                <button class="btn print-modal__option print-modal__option--format" type="button"><span>A5 - 5€</span><span class="dim">(14,8 x 21 cm)</span></button>
                <button class="btn print-modal__option print-modal__option--format" type="button"><span>A4 - 10€</span><span class="dim">(21 x 29,7 cm)</span></button>
                <button class="btn print-modal__option print-modal__option--format" type="button"><span>A3 - 20€</span><span class="dim">(29,7 x 42 cm)</span></button>
                <button class="btn print-modal__option print-modal__option--format" type="button"><span>A2 - 45</span><span class="dim">(42 x 59,4 cm)</span></button>
              </div>
            </div>
            <button class="btn btn-primary print-modal__confirm" type="button">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 7h16l-1.2 11a2 2 0 0 1-2 1.8H7.2a2 2 0 0 1-2-1.8L4 7z"></path>
                <path d="M9 7a3 3 0 1 1 6 0"></path>
              </svg>
              <span>Ajouter au pannier</span>
            </button>
          </div>
        `;

        const closeButton = overlay.querySelector('.print-modal__close');
        const confirmButton = overlay.querySelector('.print-modal__confirm');
        const optionGroups = overlay.querySelectorAll('.print-modal__options');

        function getSelectedOptionLabel(group) {
          const selectedOption = group?.querySelector('.print-modal__option.is-selected');
          if (!selectedOption) {
            return 'Non selectionne';
          }
          return selectedOption.textContent.replace(/\s+/g, ' ').trim();
        }

        function sendSelectedPrintOptions(selection) {
          console.log(selection)
          if (selection.printFormat == "Non selectionne" || selection.paperType == "Non selectionne"){
            alert ("Veuillez selectionner un format");
            return
          }
          alert(
            `Type de papier: ${selection.paperType}\nFormat d'impression: ${selection.printFormat}`
          );
        }

        optionGroups.forEach((group) => {
          const options = group.querySelectorAll('.print-modal__option');
          options.forEach((option) => {
            if (!option.hasAttribute('aria-pressed')) {
              option.setAttribute('aria-pressed', option.classList.contains('is-selected') ? 'true' : 'false');
            }

            option.addEventListener('click', () => {
              options.forEach((btn) => {
                btn.classList.remove('is-selected');
                btn.setAttribute('aria-pressed', 'false');
              });
              option.classList.add('is-selected');
              option.setAttribute('aria-pressed', 'true');
            });
          });
        });

        if (confirmButton) {
          confirmButton.addEventListener('click', () => {
            const paperGroup = optionGroups[0];
            const formatGroup = optionGroups[1];
            const selection = {
              paperType: getSelectedOptionLabel(paperGroup),
              printFormat: getSelectedOptionLabel(formatGroup)
            };

            sendSelectedPrintOptions(selection);
          });
        }

        function close() {
          overlay.classList.remove('is-open');
          document.body.classList.remove('lightbox-open');
        }

        closeButton.addEventListener('click', close);
        overlay.addEventListener('click', (event) => {
          if (event.target === overlay) {
            close();
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && overlay.classList.contains('is-open')) {
            close();
          }
        });

        document.body.appendChild(overlay);

        return {
          open() {
            overlay.classList.add('is-open');
            document.body.classList.add('lightbox-open');
          }
        };
      }

      function buildLargeImageSources(fileName) {
        const encoded = encodeURIComponent(fileName);
        const encodedPrefixed = encodeURIComponent(`grand-${fileName}`);
        return [
          `${largeImageRoot}/${encoded}`,
          `${largeImageRoot}/${encodedPrefixed}`,
          `galerie/art/${encoded}`
        ];
      }

      const imageModal = createImageModal();
      printOptionsModal = createPrintOptionsModal();

      function createPhotoCard(fileName) {
        const figure = document.createElement('figure');
        figure.className = 'art-photo-card';

        const frame = document.createElement('div');
        frame.className = 'art-photo-frame';

        const imageBox = document.createElement('div');
        imageBox.className = 'image-art-box';
        imageBox.innerHTML = `
        <button class="btn art-photo-action" type="button">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 9V4h5"></path>
            <path d="M20 9V4h-5"></path>
            <path d="M4 15v5h5"></path>
            <path d="M20 15v5h-5"></path>
          </svg>
          <span>Voir en grand</span>
        </button>
        <button class="btn art-photo-action" type="button">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 7h16l-1.2 11a2 2 0 0 1-2 1.8H7.2a2 2 0 0 1-2-1.8L4 7z"></path>
            <path d="M9 7a3 3 0 1 1 6 0"></path>
          </svg>
          <span>Ajouter au panier</span>
        </button>
        `;
        const actionButtons = imageBox.querySelectorAll('.art-photo-action');
        const viewLargeButton = actionButtons[0];
        const addToCartButton = actionButtons[1];

        const image = document.createElement('img');
        image.className = 'image-art';
        image.src = `galerie/art/${encodeURIComponent(fileName)}`;
        image.alt = fileName.replace(/\.[^/.]+$/, '').replace(/[-_]/g, ' ');
        image.loading = 'lazy';
        image.decoding = 'async';
        image.addEventListener('load', () => {
          syncCardShadow(image);
          syncImageBoxSize(image, imageBox);
        }, { once: true });

        if (viewLargeButton) {
          viewLargeButton.addEventListener('click', () => {
            imageModal.open({
              sources: buildLargeImageSources(fileName),
              alt: image.alt
            });
          });
        }

        if (addToCartButton) {
          addToCartButton.addEventListener('click', () => {
            printOptionsModal.open();
          });
        }

        if ('ResizeObserver' in window) {
          const observer = new ResizeObserver(() => {
            syncImageBoxSize(image, imageBox);
          });
          observer.observe(image);
        }

        frame.appendChild(image);
        frame.appendChild(imageBox);
        figure.appendChild(frame);

        if (image.complete && image.naturalWidth > 0) {
          syncCardShadow(image);
          syncImageBoxSize(image, imageBox);
        }

        return figure;
      }

      function renderNextBatch() {
        const nextFiles = sortedFiles.slice(renderedCount, renderedCount + batchSize);
        nextFiles.forEach((file) => {
          grid.appendChild(createPhotoCard(file));
        });
        renderedCount += nextFiles.length;

        if (renderedCount >= sortedFiles.length) {
          setLoadMoreVisible(false);
        }
      }

      if (sortedFiles.length === 0) {
        setLoadMoreVisible(false);
        grid.innerHTML = '<p>Aucune photo disponible.</p>';
        return;
      }

      renderNextBatch();
      loadMoreButton.addEventListener('click', renderNextBatch);
      setLoadMoreVisible(sortedFiles.length > batchSize);
    })();
  </script>
  <script src="script.js"></script>
</body>
</html>
